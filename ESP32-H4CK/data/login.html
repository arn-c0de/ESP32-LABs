<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - SecureNet Banking</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <a href="/" class="navbar-brand">SecureNet Banking</a>
        <button class="hamburger" onclick="document.querySelector('.navbar-nav').classList.toggle('open')">&#9776;</button>
        <ul class="navbar-nav">
            <li><a href="/">Home</a></li>
            <li><a href="/dashboard">Dashboard</a></li>
            <li><a href="/shop">Shop</a></li>
            <li><a href="/cart">Cart</a></li>
            <li><a href="/orders">Orders</a></li>
            <li><a href="/profile">Profile</a></li>
            <li><a href="/admin">Admin</a></li>
            <li><a href="/shell.html">Shell</a></li>
        </ul>
        <div class="navbar-user" id="navUser">
            <a href="/login" class="btn-nav solid active">Login</a>
        </div>
    </nav>

    <div class="login-wrap">
        <div class="login-container" id="loginBox">
            <h1>SecureNet Login</h1>
            <div id="message" class="message"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn-submit">Sign In</button>
            </form>
            <div class="default-creds">
                <h3>Default Credentials (for testing)</h3>
                <ul>
                    <li><strong>Admin:</strong> admin / admin (5000 credits)</li>
                    <li><strong>Root:</strong> root / root (5000 credits)</li>
                    <li><strong>Operator:</strong> operator / operator123 (2000 credits)</li>
                    <li><strong>Guest:</strong> guest / guest (1000 credits)</li>
                </ul>
            </div>
            <a href="/" class="back-link">Back to Home</a>
        </div>
    </div>

    <script>
        function getCookie(n){var m=document.cookie.match('(^|;)\\s*'+n+'=([^;]*)');return m?decodeURIComponent(m[2]):null}
        (function(){
            var ct=getCookie('auth_token'),cu=getCookie('auth_user'),cr=getCookie('auth_role');
            if(ct&&cu){localStorage.setItem('token',ct);localStorage.setItem('username',cu);localStorage.setItem('role',cr||'guest')}
        })();
        (function(){
            var token=localStorage.getItem('token'),username=localStorage.getItem('username'),role=localStorage.getItem('role');
            if(token&&username){
                var nav=document.getElementById('navUser');
                var rc=role==='admin'?' admin':'';
                nav.innerHTML='<div class="user-badge"><span>'+username+'</span><span class="role'+rc+'">'+role+'</span></div>'+
                    (role==='admin'?'<a href="/admin" class="btn-nav solid">Admin</a>':'')+
                    '<a href="/dashboard" class="btn-nav solid">Dashboard</a>'+
                    '<button class="btn-nav danger" onclick="doLogout()">Logout</button>';
                var box=document.getElementById('loginBox');
                box.innerHTML='<h1>Already Logged In</h1>'+
                    '<p style="text-align:center;color:#555;margin:18px 0;">You are logged in as <strong>'+username+'</strong> ('+role+').</p>'+
                    '<div style="display:flex;gap:10px;justify-content:center;margin-top:20px;flex-wrap:wrap">'+
                    '<a href="/dashboard" class="btn">Dashboard</a>'+
                    (role==='admin'?'<a href="/admin" class="btn btn-outline">Admin Panel</a>':'')+
                    '<button onclick="doLogout()" class="btn btn-danger">Logout</button></div>';
            }
        })();

        function doLogout(){
            fetch('/api/logout').finally(function(){
                localStorage.removeItem('token');localStorage.removeItem('username');localStorage.removeItem('role');
                window.location.reload();
            });
        }

        var form=document.getElementById('loginForm');
        if(form){
            form.addEventListener('submit',async function(e){
                e.preventDefault();
                var uname=document.getElementById('username').value;
                var pass=document.getElementById('password').value;
                var msg=document.getElementById('message');
                try{
                    var fd=new FormData();
                    fd.append('username',uname);fd.append('password',pass);
                    var resp=await fetch('/api/login',{method:'POST',body:fd});
                    var data=await resp.json();
                    if(data.success){
                        msg.className='message success';msg.textContent='Login successful! Redirecting...';msg.style.display='block';
                        localStorage.setItem('token',data.token);localStorage.setItem('username',data.username);localStorage.setItem('role',data.role);
                        setTimeout(function(){window.location.href='/dashboard';},600);
                    }else{
                        msg.className='message error';msg.textContent=data.error||'Login failed';msg.style.display='block';
                    }
                }catch(err){
                    msg.className='message error';msg.textContent='Network error: '+err.message;msg.style.display='block';
                }
            });
        }
    </script>
    <script src="/js/navbar.js"></script>
</body>
</html>
