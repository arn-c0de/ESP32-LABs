<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureNet Banking - ESP32-H4CK</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <a href="/" class="navbar-brand">SecureNet Banking</a>
        <button class="hamburger" onclick="document.querySelector('.navbar-nav').classList.toggle('open')">&#9776;</button>
        <ul class="navbar-nav">
            <li><a href="/" class="active">Home</a></li>
            <li><a href="/dashboard">Dashboard</a></li>
            <li><a href="/transactions">Transactions</a></li>
            <li><a href="/transfer">Transfer</a></li>
            <li><a href="/profile">Profile</a></li>
            <li><a href="/admin">Admin</a></li>
            <li><a href="/shell.html">Shell</a></li>
        </ul>
        <div class="navbar-user" id="navUser">
            <a href="/login" class="btn-nav solid">Login</a>
        </div>
    </nav>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1>SecureNet Banking</h1>
                <p class="version">ESP32-H4CK Vulnerable Lab v2.5.1</p>
            </div>

            <div class="warning">
                <strong>Warning - Educational Lab Environment</strong>
                This system contains intentional security vulnerabilities for cybersecurity training and penetration testing education. Deploy ONLY in isolated lab environments.
            </div>

            <div class="quick-actions" id="authActions" style="display:none;">
                <a href="/dashboard" class="btn btn-lg">Dashboard</a>
                <a href="/transfer" class="btn btn-lg">Transfer Funds</a>
                <a href="/transactions" class="btn btn-lg btn-outline">Transactions</a>
            </div>

            <h2>Available Endpoints</h2>
            <ul class="endpoint-list">
                <li class="endpoint-item">
                    <span class="method get">GET</span>
                    <a href="/login">/login</a>
                    <p>User authentication page (default: admin/admin, guest/guest)</p>
                </li>
                <li class="endpoint-item">
                    <span class="method get">GET</span>
                    <a href="/dashboard">/dashboard</a>
                    <p>User dashboard with balance and recent transactions</p>
                </li>
                <li class="endpoint-item">
                    <span class="method get">GET</span>
                    <a href="/admin">/admin</a>
                    <p>Admin panel with user & wallet management</p>
                </li>
                <li class="endpoint-item">
                    <span class="method get">GET</span>
                    <a href="/api/wallet/balance">/api/wallet/balance</a>
                    <p>Wallet balance API (IDOR: try ?user_id=1)</p>
                </li>
                <li class="endpoint-item">
                    <span class="method post">POST</span>
                    <a href="/transfer">/api/wallet/transfer</a>
                    <p>Fund transfer (IDOR + Race Condition)</p>
                </li>
                <li class="endpoint-item">
                    <span class="method get">GET</span>
                    <a href="/api/info">/api/info</a>
                    <p>System information and status</p>
                </li>
                <li class="endpoint-item">
                    <span class="method get">GET</span>
                    <a href="/api/users">/api/users</a>
                    <p>User management API (vulnerable to injection)</p>
                </li>
                <li class="endpoint-item">
                    <span class="method get">GET</span>
                    <a href="/shell.html">/shell.html</a>
                    <p>WebSocket-based interactive shell</p>
                </li>
                <li class="endpoint-item">
                    <span class="method get">GET</span>
                    <a href="/vuln/search?q=admin">/vuln/search</a>
                    <p>Search endpoint (vulnerable to SQL injection)</p>
                </li>
                <li class="endpoint-item">
                    <span class="method get">GET</span>
                    <a href="/api/endpoints">/api/endpoints</a>
                    <p>Full endpoint discovery</p>
                </li>
            </ul>

            <div class="btn-group" style="text-align:center;margin:24px 0;display:flex;flex-wrap:wrap;gap:10px;justify-content:center;">
                <a href="/login" class="btn" id="btnLogin">Login</a>
                <a href="/shell.html" class="btn">Web Shell</a>
                <a href="/api/info" class="btn btn-outline">System Info</a>
                <a href="/admin" class="btn btn-outline" id="btnAdmin" style="display:none;">Admin Panel</a>
            </div>

            <h2>Other Services</h2>
            <ul class="endpoint-list">
                <li class="endpoint-item">
                    <strong>Telnet Service:</strong> Port 23
                    <p>Connect with: <code>telnet &lt;device-ip&gt; 23</code></p>
                </li>
                <li class="endpoint-item">
                    <strong>WebSocket Shell:</strong> ws://&lt;device-ip&gt;/shell
                    <p>Interactive command shell via WebSocket</p>
                </li>
            </ul>

            <div class="footer">
                <p>ESP32-H4CK Vulnerable Lab - SecureNet Banking Edition - For Educational Use Only</p>
            </div>
        </div>
    </div>

    <script>
        function getCookie(n){var m=document.cookie.match('(^|;)\\s*'+n+'=([^;]*)');return m?decodeURIComponent(m[2]):null}
        (function(){
            var ct=getCookie('auth_token'),cu=getCookie('auth_user'),cr=getCookie('auth_role');
            if(ct&&cu){localStorage.setItem('token',ct);localStorage.setItem('username',cu);localStorage.setItem('role',cr||'guest')}
        })();
        (function(){
            var token=localStorage.getItem('token'),username=localStorage.getItem('username'),role=localStorage.getItem('role');
            var nav=document.getElementById('navUser');
            if(token&&username){
                // Fetch balance for navbar
                fetch('/api/wallet/balance',{headers:{'Authorization':'Bearer '+token}})
                .then(function(r){return r.json()}).then(function(d){
                    var bal=d.balance!==undefined?' | '+d.balance.toFixed(0)+' credits':'';
                    var rc=role==='admin'?' admin':'';
                    nav.innerHTML='<div class="user-badge"><span>'+username+'</span><span class="balance">'+bal+'</span><span class="role'+rc+'">'+role+'</span></div>'+
                        (role==='admin'?'<a href="/admin" class="btn-nav solid">Admin</a>':'')+
                        '<a href="/dashboard" class="btn-nav solid">Dashboard</a>'+
                        '<button class="btn-nav danger" onclick="doLogout()">Logout</button>';
                }).catch(function(){
                    var rc=role==='admin'?' admin':'';
                    nav.innerHTML='<div class="user-badge"><span>'+username+'</span><span class="role'+rc+'">'+role+'</span></div>'+
                        '<button class="btn-nav danger" onclick="doLogout()">Logout</button>';
                });
                document.getElementById('btnLogin').style.display='none';
                document.getElementById('authActions').style.display='flex';
                if(role==='admin')document.getElementById('btnAdmin').style.display='';
            }
        })();
        function doLogout(){
            fetch('/api/logout').finally(function(){
                localStorage.removeItem('token');localStorage.removeItem('username');localStorage.removeItem('role');
                window.location.href='/login';
            });
        }
    </script>
</body>
</html>
